{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="card">
    <h1>ðŸ“¡ {{ title }}</h1>
    <p><strong>Target Host:</strong> {{ host }}</p>
    <p><strong>Status:</strong> <span class="status-indicator status-online"></span> <span id="connection-status">Monitoring...</span></p>
    <p><strong>Last Update:</strong> <span id="last-update">--</span></p>
</div>

<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-value" id="packets-sent">0</div>
        <div class="stat-label">Packets Sent</div>
    </div>
    <div class="stat-card">
        <div class="stat-value" id="packets-received">0</div>
        <div class="stat-label">Packets Received</div>
    </div>
    <div class="stat-card">
        <div class="stat-value" id="packet-loss">0%</div>
        <div class="stat-label">Packet Loss</div>
    </div>
    <div class="stat-card">
        <div class="stat-value" id="avg-latency">--</div>
        <div class="stat-label">Avg Latency</div>
    </div>
</div>

<div class="card">
    <h2>ðŸ“Š Real-time Ping Results</h2>
    <div class="log-container" id="ping-log">
        <div class="log-line">Initializing ping monitor for {{ host }}...</div>
        <div class="log-line">Waiting for data...</div>
    </div>
</div>

<div class="card">
    <h2>ðŸ“ˆ Connection Statistics</h2>
    <div id="stats-container">
        <div class="log-line">Statistics will appear here as data is collected...</div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    console.log('ðŸ  Internal ping AJAX system starting');
    
    function updateInternalPing() {
        fetch('/api/live-ping/internal')
            .then(response => response.json())
            .then(data => {
                const logContainer = document.getElementById('ping-logs');
                if (!logContainer) return;
                
                logContainer.innerHTML = '';
                
                if (data.data && data.data.length > 0) {
                    data.data.forEach(entry => {
                        const logLine = document.createElement('div');
                        logLine.innerHTML = `[${entry.timestamp}] ${entry.data}`;
                        if (entry.data.includes('Reply from')) {
                            logLine.style.color = '#27ae60';
                        } else if (entry.data.includes('timeout')) {
                            logLine.style.color = '#e74c3c';
                        }
                        logContainer.appendChild(logLine);
                    });
                    logContainer.scrollTop = logContainer.scrollHeight;
                }
                
                // Update counter
                const counterElement = document.getElementById('packets-sent');
                if (counterElement && data.counter) {
                    counterElement.textContent = data.counter;
                }
            })
            .catch(error => {
                console.error('Error loading internal ping:', error);
            });
    }
    
    // Auto-refresh
    setInterval(updateInternalPing, 2000);
    setTimeout(updateInternalPing, 1000);
</script>
{% endblock %}
